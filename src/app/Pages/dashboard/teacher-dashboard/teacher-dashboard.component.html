<div class="d-flex" id="wrapper">
  <!-- SIDEBAR (desktop) -->
  <aside
    class="bg-white border-end sticky-top d-none d-md-block"
    id="sidebar"
    style="min-width: 260px; height: 100vh; overflow-y: auto"
  >
    <div class="sidebar-heading text-center py-4 border-bottom mb-3">
      <div class="fw-bold text-primary fs-4">
        <i class="bi bi-mortarboard-fill me-2"></i>Faculty Portal
      </div>
      <small class="text-muted">Instructor Access</small>
    </div>

    <div class="list-group list-group-flush px-2">
      <button
        class="list-group-item list-group-item-action border-0 rounded mb-2"
        [class.active-tab]="currentView === 'dashboard'"
        (click)="switchView('dashboard')"
      >
        <i class="bi bi-grid-1x2-fill me-2"></i> Dashboard
      </button>
      <button
        class="list-group-item list-group-item-action border-0 rounded mb-2"
        [class.active-tab]="currentView === 'exams'"
        (click)="switchView('exams')"
      >
        <i class="bi bi-file-earmark-text me-2"></i> Exam Management
      </button>
      <button
        class="list-group-item list-group-item-action border-0 rounded mb-2"
        [class.active-tab]="currentView === 'reports'"
        (click)="switchView('reports')"
      >
        <i class="bi bi-graph-up-arrow me-2"></i> Gradebook & Reports
      </button>
      <button
        class="list-group-item list-group-item-action border-0 rounded mb-2"
        [class.active-tab]="currentView === 'settings'"
        (click)="switchView('settings')"
      >
        <i class="bi bi-gear me-2"></i> Profile & Settings
      </button>

      <button
        class="list-group-item list-group-item-action text-danger border-0 mt-5"
        (click)="logout()"
      >
        <i class="bi bi-box-arrow-left me-2"></i> Logout
      </button>
    </div>
  </aside>

  <!-- Offcanvas sidebar (mobile) -->
  <div
    class="offcanvas offcanvas-start d-md-none"
    tabindex="-1"
    id="mobileSidebar"
    aria-labelledby="mobileSidebarLabel"
  >
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="mobileSidebarLabel">
        <i class="bi bi-mortarboard-fill me-2"></i>Faculty Portal
      </h5>
      <button
        type="button"
        class="btn-close text-reset"
        data-bs-dismiss="offcanvas"
        aria-label="Close"
      ></button>
    </div>
    <div class="offcanvas-body p-0">
      <div class="list-group list-group-flush px-2">
        <button
          class="list-group-item list-group-item-action border-0 rounded mb-2"
          [class.active-tab]="currentView === 'dashboard'"
          (click)="switchView('dashboard')"
          data-bs-dismiss="offcanvas"
        >
          <i class="bi bi-grid-1x2-fill me-2"></i> Dashboard
        </button>
        <button
          class="list-group-item list-group-item-action border-0 rounded mb-2"
          [class.active-tab]="currentView === 'exams'"
          (click)="switchView('exams')"
          data-bs-dismiss="offcanvas"
        >
          <i class="bi bi-file-earmark-text me-2"></i> Exam Management
        </button>
        <button
          class="list-group-item list-group-item-action border-0 rounded mb-2"
          [class.active-tab]="currentView === 'reports'"
          (click)="switchView('reports')"
          data-bs-dismiss="offcanvas"
        >
          <i class="bi bi-graph-up-arrow me-2"></i> Gradebook & Reports
        </button>
        <button
          class="list-group-item list-group-item-action border-0 rounded mb-2"
          [class.active-tab]="currentView === 'settings'"
          (click)="switchView('settings')"
          data-bs-dismiss="offcanvas"
        >
          <i class="bi bi-gear me-2"></i> Profile & Settings
        </button>

        <button
          class="list-group-item list-group-item-action text-danger border-0 mt-3"
          (click)="logout()"
        >
          <i class="bi bi-box-arrow-left me-2"></i> Logout
        </button>
      </div>
    </div>
  </div>

  <!-- MAIN CONTENT AREA -->
  <div id="page-content-wrapper" class="w-100 bg-light">
    <!-- TOP NAVBAR -->
    <nav
      class="navbar navbar-light bg-white border-bottom shadow-sm px-3 px-md-4 py-2"
    >
      <div class="d-flex align-items-center w-100">
        <!-- mobile toggle -->
        <button
          class="btn d-md-none me-3 p-0"
          type="button"
          data-bs-toggle="offcanvas"
          data-bs-target="#mobileSidebar"
          aria-controls="mobileSidebar"
          aria-label="Toggle navigation"
        >
          <i class="bi bi-list fs-3 text-dark"></i>
        </button>

        <div class="d-flex align-items-center">
          <h5 class="m-0 fw-bold text-dark text-uppercase small text-truncate">
            {{ currentView | titlecase }}
          </h5>
        </div>

        <div
          class="ms-auto d-flex align-items-center cursor-pointer"
          *ngIf="currentUser as user"
          (click)="switchView('settings')"
        >
          <div class="text-end me-3 d-none d-md-block">
            <div class="fw-bold text-dark">{{ user.name }}</div>
            <div class="small text-muted">{{ user.email }}</div>
          </div>

          <img
            *ngIf="user.profileImageUrl"
            [src]="user.profileImageUrl"
            class="rounded-circle border"
            width="40"
            height="40"
            style="object-fit: cover"
            (error)="user.profileImageUrl = null"
          />

          <div
            *ngIf="!user.profileImageUrl"
            class="rounded-circle bg-primary text-white d-flex justify-content-center align-items-center fw-bold"
            style="width: 40px; height: 40px"
          >
            {{ (user.name || "U").charAt(0) | uppercase }}
          </div>
        </div>
      </div>
    </nav>

    <div class="container-fluid p-3 p-md-4">
      <!-- 1. DASHBOARD OVERVIEW -->
      <div
        *ngIf="currentView === 'dashboard'"
        class="animate__animated animate__fadeIn"
      >
        <!-- Metrics Cards -->
        <div class="row g-3 g-md-4 mb-4">
          <div class="col-12 col-md-4">
            <div
              class="card border-0 shadow-sm h-100 p-3 border-start border-4 border-primary"
            >
              <div
                class="card-body d-flex justify-content-between align-items-center"
              >
                <div>
                  <h6 class="text-muted text-uppercase small mb-1">
                    Active Exams
                  </h6>
                  <h2 class="mb-0 fw-bold text-dark">{{ myQuizzes.length }}</h2>
                </div>
                <div class="bg-primary-subtle text-primary rounded-circle p-3">
                  <i class="bi bi-file-text fs-4"></i>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div
              class="card border-0 shadow-sm h-100 p-3 border-start border-4 border-success"
            >
              <div
                class="card-body d-flex justify-content-between align-items-center"
              >
                <div>
                  <h6 class="text-muted text-uppercase small mb-1">
                    Total Attempts
                  </h6>
                  <h2 class="mb-0 fw-bold text-dark">{{ totalStudents }}</h2>
                </div>
                <div class="bg-success-subtle text-success rounded-circle p-3">
                  <i class="bi bi-people fs-4"></i>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div
              class="card border-0 shadow-sm h-100 p-3 border-start border-4 border-warning"
            >
              <div
                class="card-body d-flex justify-content-between align-items-center"
              >
                <div>
                  <h6 class="text-muted text-uppercase small mb-1">
                    Avg. Performance
                  </h6>
                  <h2 class="mb-0 fw-bold text-dark">{{ avgScorePercent }}%</h2>
                </div>
                <div class="bg-warning-subtle text-warning rounded-circle p-3">
                  <i class="bi bi-graph-up-arrow fs-4"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="card border-0 shadow-sm mb-3">
          <div class="card-body p-3 p-md-4">
            <h5 class="fw-bold mb-3">Quick Actions</h5>
            <div class="d-flex flex-wrap gap-2">
              <button class="btn btn-primary px-4" (click)="openCreateModal()">
                <i class="bi bi-plus-lg me-2"></i>Create Exam
              </button>
              <button
                class="btn btn-outline-secondary px-4"
                (click)="switchView('reports')"
              >
                <i class="bi bi-clipboard-data me-2"></i>View Reports
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- 2. EXAMS MANAGEMENT -->
      <div
        *ngIf="currentView === 'exams'"
        class="animate__animated animate__fadeIn"
      >
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4 class="fw-bold m-0">My Exams</h4>
          <button class="btn btn-primary shadow-sm" (click)="openCreateModal()">
            + Create New Exam
          </button>
        </div>

        <div class="row g-3 g-md-4">
          <div class="col-12 col-md-6 col-xl-4" *ngFor="let quiz of myQuizzes">
            <div class="card h-100 border-0 shadow-sm hover-card">
              <div class="card-body p-3 p-md-4 d-flex flex-column">
                <div class="d-flex justify-content-between mb-2">
                  <span
                    class="badge"
                    [ngClass]="quiz.active ? 'bg-success' : 'bg-secondary'"
                    >{{ quiz.active ? "Active" : "Draft" }}</span
                  >
                  <div class="dropdown">
                    <button
                      class="btn btn-link text-muted p-0"
                      data-bs-toggle="dropdown"
                    >
                      <i class="bi bi-three-dots-vertical"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end border-0 shadow">
                      <li>
                        <button
                          class="dropdown-item"
                          (click)="copyLink(quiz.code)"
                        >
                          Copy Link
                        </button>
                      </li>
                      <li>
                        <button
                          class="dropdown-item"
                          (click)="toggleQuizStatus(quiz)"
                        >
                          {{ quiz.active ? "Deactivate" : "Activate" }}
                        </button>
                      </li>
                      <li>
                        <hr class="dropdown-divider" />
                      </li>
                      <li>
                        <button
                          class="dropdown-item text-danger"
                          (click)="deleteQuiz(quiz.id)"
                        >
                          Delete
                        </button>
                      </li>
                    </ul>
                  </div>
                </div>

                <h5 class="card-title fw-bold mb-1 text-truncate">
                  {{ quiz.title }}
                </h5>
                <p class="text-muted small mb-3 line-clamp-2 text-truncate">
                  {{ quiz.cleanDescription || quiz.description }}
                </p>

                <div class="mt-auto">
                  <div
                    class="d-flex justify-content-between small text-muted mb-3 flex-wrap"
                  >
                    <span class="me-2"
                      ><i class="bi bi-hash"></i> {{ quiz.code }}</span
                    >
                    <span class="me-2"
                      ><i class="bi bi-question-circle"></i>
                      {{ quiz.questionsCount }} Qs</span
                    >
                    <span
                      ><i class="bi bi-clock"></i>
                      {{ quiz.timeLimit || 60 }}m</span
                    >
                  </div>
                  <div class="d-grid gap-2">
                    <button
                      class="btn btn-outline-primary btn-sm"
                      [routerLink]="['/quiz-builder', quiz.id]"
                    >
                      <i class="bi bi-pencil-square me-1"></i> Edit Questions
                    </button>
                    <button
                      class="btn btn-outline-primary w-100 fw-bold"
                      (click)="openAnalyticsModal(quiz.id, quiz.title)"
                    >
                      <i class="bi bi-bar-chart-line-fill me-2"></i> View
                      Analytics
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div *ngIf="myQuizzes.length === 0" class="col-12 text-center py-5">
            <img
              src="assets/img/empty-state.svg"
              width="150"
              class="mb-3 opacity-50"
              onerror="this.style.display = 'none'"
            />
            <h5 class="text-muted">No exams found</h5>
            <p class="text-muted small">
              Exams you create will appear here with analytics & reports
            </p>

            <button class="btn btn-link" (click)="openCreateModal()">
              Create your first exam
            </button>
          </div>
        </div>
      </div>

      <!-- 3. REPORTS / GRADEBOOK -->
      <div
        *ngIf="currentView === 'reports'"
        class="animate__animated animate__fadeIn"
      >
        <div class="card border-0 shadow-sm mb-3">
          <div class="card-header bg-white py-3">
            <h5 class="m-0 fw-bold">Select an Exam to View Report</h5>
          </div>
          <div class="list-group list-group-flush">
            <button
              *ngFor="let quiz of myQuizzes"
              class="list-group-item list-group-item-action p-3 d-flex justify-content-between align-items-center"
              (click)="openReportModal(quiz.id, quiz.title)"
            >
              <div>
                <h6 class="mb-0 fw-bold text-primary text-truncate">
                  {{ quiz.title }}
                </h6>
                <small class="text-muted"
                  >Code: {{ quiz.code }} ‚Ä¢
                  {{ quiz.questionsCount }} Questions</small
                >
              </div>
              <i class="bi bi-chevron-right text-muted"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- 4. SETTINGS -->
      <div
        *ngIf="currentView === 'settings' && currentUser as user"
        class="animate__animated animate__fadeIn"
      >
        <div class="row justify-content-center">
          <div class="col-12 col-lg-8">
            <div class="card shadow-sm border-0">
              <div class="card-body p-3 p-md-5">
                <h4 class="mb-4 fw-bold">Profile Settings</h4>
                <div class="row mb-4">
                  <div class="col-12 col-md-3 text-center mb-3 mb-md-0">
                    <img
                      [src]="
                        imagePreview ||
                        user.profileImageUrl ||
                        'assets/img/default-avatar.png'
                      "
                      class="rounded-circle border shadow-sm"
                      width="100"
                      height="100"
                      style="object-fit: cover"
                    />
                    <label class="btn btn-sm btn-light mt-2 border">
                      Upload
                      <input
                        type="file"
                        hidden
                        (change)="onProfileImageSelected($event)"
                      />
                    </label>
                  </div>
                  <div class="col-12 col-md-9">
                    <div class="mb-3">
                      <label class="form-label small fw-bold">Name</label
                      ><input
                        type="text"
                        class="form-control"
                        [(ngModel)]="user.name"
                      />
                    </div>
                    <div class="mb-3">
                      <label class="form-label small fw-bold">Email</label
                      ><input
                        type="text"
                        class="form-control bg-light"
                        [value]="user.email"
                        disabled
                      />
                    </div>
                    <div class="row mb-3">
                      <div class="col-6">
                        <label class="form-label small text-muted"
                          >User Type</label
                        >
                        <div class="form-control bg-white">
                          {{ user.userType }}
                        </div>
                      </div>
                      <div class="col-6">
                        <label class="form-label small text-muted"
                          >Institution</label
                        >
                        <div class="form-control bg-white text-truncate">
                          {{ institutionDetails.instituteName }}
                        </div>
                        <div class="form-control bg-white text-truncate mt-1">
                          {{ institutionDetails.instituteLocation }}
                        </div>
                      </div>
                    </div>
                    <button class="btn btn-primary" (click)="updateProfile()">
                      Save Changes
                    </button>
                  </div>
                </div>
                <h6 class="text-muted border-bottom pb-2 mb-3 mt-4">
                  Security
                </h6>
                <form (ngSubmit)="changePassword()">
                  <div class="row">
                    <div class="col-12 col-md-4 mb-3">
                      <label class="form-label small fw-bold"
                        >Current Password</label
                      >
                      <input
                        type="password"
                        class="form-control"
                        [(ngModel)]="passwordData.currentPassword"
                        name="cp"
                      />
                    </div>
                    <div class="col-12 col-md-4 mb-3">
                      <label class="form-label small fw-bold"
                        >New Password</label
                      >
                      <input
                        type="password"
                        class="form-control"
                        [(ngModel)]="passwordData.newPassword"
                        name="np"
                      />
                    </div>
                    <div class="col-12 col-md-4 mb-3">
                      <label class="form-label small fw-bold">Confirm</label>
                      <input
                        type="password"
                        class="form-control"
                        [(ngModel)]="passwordData.confirmPassword"
                        name="cfp"
                      />
                    </div>
                  </div>
                  <div class="text-end">
                    <button type="submit" class="btn btn-danger px-4">
                      Update Password
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- end settings -->
    </div>
    <!-- container-fluid -->
  </div>
  <!-- page-content-wrapper -->
</div>

<!-- wrapper -->

<!-- wrapper -->

<!-- ================= DOWNLOAD FORMAT MODAL ================= -->
<div
  class="modal fade"
  id="downloadFormatModal"
  tabindex="-1"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow">
      <div class="modal-header">
        <h5 class="modal-title fw-bold">Download Report</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body text-center">
        <p class="mb-3 fw-semibold">Choose download format</p>

        <div *ngIf="isDownloading" class="mt-4">
          <div class="d-flex align-items-center gap-3 justify-content-center">
            <div class="spinner-border text-primary" role="status"></div>
            <div class="fw-semibold">Downloading‚Ä¶ {{ downloadProgress }}%</div>
          </div>

          <div class="progress mt-3">
            <div
              class="progress-bar progress-bar-striped progress-bar-animated"
              [style.width.%]="downloadProgress"
            ></div>
          </div>
        </div>

        <div class="d-flex justify-content-center gap-3">
          <button
            class="btn btn-success px-4"
            [disabled]="isDownloading"
            (click)="confirmDownload('CSV')"
          >
            <i class="bi bi-file-earmark-excel-fill me-1"></i> Excel (CSV)
          </button>

          <button
            class="btn btn-danger px-4"
            [disabled]="isDownloading"
            (click)="confirmDownload('PDF')"
          >
            <i class="bi bi-file-earmark-pdf-fill me-1"></i> PDF
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ================= ANALYTICS / PARTICIPANTS MODAL ================= -->
<!-- ================= ANALYTICS / PARTICIPANTS MODAL ================= -->
<div class="modal fade" id="analyticsModal" tabindex="-1">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <!-- HEADER -->
      <div class="modal-header">
        <h5 class="modal-title fw-bold">
          Performance Report: {{ selectedQuizTitle }}
        </h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <!-- FILTERS -->
      <div class="modal-body pt-2">
        <!-- DATE FILTER -->
        <div class="row g-2 mb-3 align-items-end">
          <div class="col-md-3">
            <label class="form-label small">From</label>
            <input type="date" class="form-control" [(ngModel)]="fromDate" />
          </div>
          <div class="col-md-3">
            <label class="form-label small">To</label>
            <input type="date" class="form-control" [(ngModel)]="toDate" />
          </div>
          <div class="col-md-6 text-end">
            <button
              class="btn btn-primary me-2"
              (click)="loadAnalyticsByDate()"
            >
              Apply
            </button>
            <button
              class="btn btn-outline-secondary me-2"
              (click)="resetDateFilter()"
            >
              Reset
            </button>
            <button class="btn btn-success" (click)="openDownloadModal()">
              Download
            </button>
          </div>
        </div>

        <!-- FILTER CHIPS -->
        <div class="d-flex flex-wrap gap-2 mb-3">
          <button class="btn btn-dark btn-sm" (click)="applyFilter('ALL')">
            All Students ({{ summary.total }})
          </button>
          <button
            class="btn btn-outline-success btn-sm"
            (click)="applyFilter('PASS')"
          >
            Passed
          </button>
          <button
            class="btn btn-outline-danger btn-sm"
            (click)="applyFilter('FAIL')"
          >
            Failed
          </button>

          <div class="ms-auto d-flex gap-2">
            <button
              class="btn btn-outline-secondary btn-sm"
              (click)="applyFilter('TOP')"
            >
              Highest
            </button>
            <button
              class="btn btn-outline-secondary btn-sm"
              (click)="applyFilter('LOW')"
            >
              Lowest
            </button>
          </div>
        </div>

        <!-- SEARCH -->
        <input
          type="text"
          class="form-control mb-3"
          placeholder="Search student by name or email"
          [(ngModel)]="studentSearch"
          (input)="applyFilter(activeFilter)"
        />

        <!-- TABLE -->
        <div class="table-responsive">
          <table class="table align-middle">
            <thead>
              <tr>
                <th>Student</th>
                <th>Contact</th>
                <th>Performance</th>
                <th>Grade</th>
                <th>Attempted On</th>
                <th>Action</th>
              </tr>
            </thead>

            <tbody>
              <tr *ngFor="let p of filteredParticipants">
                <td>{{ p.name || p.studentName }}</td>
                <td>{{ p.email }}</td>
                <td>{{ p.score }} / {{ p.totalQuestions }}</td>
                <td>
                  <span
                    class="badge"
                    [ngClass]="
                      p.score / p.totalQuestions >= 0.5
                        ? 'bg-success'
                        : 'bg-danger'
                    "
                  >
                    {{ p.score / p.totalQuestions >= 0.5 ? "PASS" : "FAIL" }}
                  </span>
                </td>
                <td>{{ p.attemptDate | date: "medium" }}</td>
                <td>
                  <button
                    class="btn btn-sm btn-outline-primary"
                    (click)="viewStudentAttempt(getResultId(p))"
                  >
                    View
                  </button>
                </td>
              </tr>

              <tr *ngIf="filteredParticipants.length === 0">
                <td colspan="6" class="text-center text-muted">
                  No data found
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- FOOTER -->
      <div class="modal-footer">
        <button class="btn btn-primary" data-bs-dismiss="modal">
          Close Report
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ================= ANSWER SHEET MODAL ================= -->
<div class="modal fade" id="answerSheetModal" tabindex="-1">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title fw-bold">
          {{ answerSheet?.quizTitle }} ‚Äî Answer Sheet
        </h5>

        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <div class="mb-3 text-muted small">
          Score:
          <strong
            >{{ answerSheet?.score }}/{{ answerSheet?.totalQuestions }}</strong
          >
        </div>

        <div
          *ngFor="let q of answerSheet?.questions; let i = index"
          class="border rounded p-3 mb-3"
        >
          <div class="fw-bold mb-2">Q{{ i + 1 }}. {{ q.content }}</div>

<div
  *ngFor="let opt of q.options"
  class="p-2 rounded mb-1 border"
  [ngClass]="{
    'bg-success-subtle border-success':
      opt === q.correctAnswer,

    'bg-danger-subtle border-danger':
      answerSheet?.userAnswers[q.id] === opt &&
      opt !== q.correctAnswer
  }"
>
  {{ opt }}

  <!-- ‚úÖ Correct answer badge (always visible) -->
  <span
    *ngIf="opt === q.correctAnswer"
    class="badge bg-success ms-2"
  >
    Correct Answer
  </span>

  <!-- ‚ùå Wrong selected option badge -->
  <span
    *ngIf="
      answerSheet?.userAnswers[q.id] === opt &&
      opt !== q.correctAnswer
    "
    class="badge bg-danger ms-2"
  >
    Your Answer
  </span>
</div>

          <!-- ‚≠ï NOT ATTEMPTED LABEL -->
          <div
            *ngIf="answerSheet?.userAnswers[q.id] == null"
            class="mt-2 text-warning fw-bold"
          >
            ‚≠ï Not Attempted
          </div>
        </div>
      </div>

      <div class="modal-footer d-flex justify-content-between">
        <button
          class="btn btn-danger"
          (click)="downloadAnswerSheetPdf(selectedResultId)"
        >
          <i class="bi bi-file-earmark-pdf-fill me-1"></i>
          Download PDF
        </button>
        <!-- <button
  *ngIf="answerSheet?.retakeAllowed"
  class="btn btn-warning"
  (click)="retakeQuiz()">

  üîÅ Retake Quiz (Attempt {{ answerSheet.attemptNumber + 1 }})
</button> -->
        <button
          *ngIf="
            !answerSheet?.retakeAllowed &&
            answerSheet?.facultyEmail === currentUser?.email
          "
          class="btn btn-sm btn-warning"
          (click)="confirmAndRetake()"
        >
          Allow Retake
        </button>

        <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- ================= CREATE QUIZ MODAL ================= -->
<div class="modal fade" id="createQuizModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content shadow border-0">
      <div class="modal-header">
        <h5 class="fw-bold">Create Quiz</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <input
          class="form-control mb-2"
          placeholder="Quiz Title"
          [(ngModel)]="newQuiz.title"
        />

        <textarea
          class="form-control mb-3"
          placeholder="Description"
          [(ngModel)]="newQuiz.description"
        >
        </textarea>

        <!-- üîΩ Import Questions -->
        <div class="border rounded p-3 bg-light">
          <label class="form-label fw-semibold small">
            Import Questions (optional)
          </label>

          <!-- Template actions -->
          <div class="d-flex gap-2 mb-2">
            <button
              type="button"
              class="btn btn-outline-secondary btn-sm"
              (click)="downloadTemplate('csv')"
            >
              <i class="bi bi-download"></i> CSV Template
            </button>

            <button
              type="button"
              class="btn btn-outline-secondary btn-sm"
              (click)="downloadTemplate('txt')"
            >
              <i class="bi bi-download"></i> TXT Template
            </button>
          </div>

          <input
            type="file"
            class="form-control"
            (change)="onImportFileSelected($event)"
            accept=".csv,.txt"
          />

          <div class="form-text text-muted mt-1">
            Download template ‚Üí fill questions ‚Üí upload here
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">
          Cancel
        </button>
        <button class="btn btn-primary" (click)="createQuiz()">Create</button>
      </div>
    </div>
  </div>
</div>
